sudo: true
language: node_js
cache:
  bundler: true
  directories:
    - node_modules
node_js:
- '0.10'
before_install:
- sudo apt-get update -qq
- sudo apt-get install -qq libbluetooth-dev
before_deploy:
- mkdir -p deploy/meshblu-bean/latest
- mkdir -p deploy/meshblu-bean/$TRAVIS_TAG
- node_modules/.bin/browserify -s Connector connector.js > deploy/meshblu-bean/latest/meshblu-bean.js
- gzip deploy/meshblu-bean/latest/meshblu-bean.js
- mv deploy/meshblu-bean/latest/meshblu-bean.js.gz deploy/meshblu-bean/latest/meshblu-bean.js
- cp deploy/meshblu-bean/latest/meshblu-bean.js deploy/meshblu-bean/$TRAVIS_TAG/meshblu-bean.js
deploy:
- provider: npm
  skip_cleanup: true
  clean_up: false
  email: serveradmin@octoblu.com
  api_key:
    secure: "YQdMDAzy0afknIAkV2jXtkA539qWuWnf+0lTNzKIbihKxT23/138aKqT9yRr8fBcu902vkIlIhap0iKxIbXX1BmI4iUcjeU8UcAi1kSvFT5ZfXwB7RfmMQpXT80TkpHErJxEtowo+biP7W+RhzYVmEzHmCicVn3pTWwaUmgwME4="
  on:
    tags: true
    all_branches: true
- provider: s3
  access_key_id: AKIAJFJGT4PA3PB7DIYQ
  secret_access_key:
    secure: "fyP3kWrOdAbNv1yBT2jWcP2DBCEqWeu/zI7JGokj5YUtA0QNrEuheWKWMpXxK5WzpfaHhmgq6Xy+fa1HGCqEzptOZDiCs94HZuP8KY0dmyKxVm2Kasjo6vye0rsmRKG5BaI31Bu3H3qR8AH3LAIN3yYoId7NQrzNQRyAJVCEJMI="
  bucket: octoblu-cdn
  region: us-west-2
  skip_cleanup: true
  detect_encoding: true
  local-dir: deploy
  upload-dir: js
  on:
    tags: true
    all_branches: true
